#!/bin/bash
PKGLIST_FILE="$1"
DEBIAN_FRONTEND=noninteractive

function exitscript() {
	if [ $1 -eq 0 ]; then
		echo "SCRIPT OK"
		exit 0
	else
		echo "SCRIPT ERROR $1"
		exit $1
	fi
}

[ -e $PKGLIST_FILE ] || exitscript 1

## apt-get install rsync
## sync repository

# update apt repository
apt-get update 2>&1 || exitscript $?

# install dselect (install from list of packages generated by dpkg --get-selections)
apt-get install -y dselect 2>&1 || exitscript $?

# update dselect repository
dselect update 2>&1 || exitscript $?

# mark packages listed on $PKGLIST_FILE for installation
dpkg --set-selections 2>&1 < $PKGLIST_FILE || exitscript $?

# apt-get as frontend to dselect, installing marked packages
apt-get dselect-upgrade -y 2>&1 || exitscript $?

echo "SCRIPT OK"
reboot >/dev/null 2>&1
